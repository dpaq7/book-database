const e={baseUrl:"https://book-database-backend.onrender.com/api",init(){},async get(e){try{let t=await fetch(`${this.baseUrl}/${e}`);if(!t.ok)throw Error(`HTTP error! Status: ${t.status}`);return await t.json()}catch(e){throw console.error("API GET Error:",e),e}},async post(e,t){try{let o=await fetch(`${this.baseUrl}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw Error(`HTTP error! Status: ${o.status}`);return await o.json()}catch(e){throw console.error("API POST Error:",e),e}},async put(e,t){try{let o=await fetch(`${this.baseUrl}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw Error(`HTTP error! Status: ${o.status}`);return await o.json()}catch(e){throw console.error("API PUT Error:",e),e}},async delete(e){try{let t=await fetch(`${this.baseUrl}/${e}`,{method:"DELETE"});if(!t.ok)throw Error(`HTTP error! Status: ${t.status}`);return await t.json()}catch(e){throw console.error("API DELETE Error:",e),e}},async uploadFile(e,t,o){try{let o=new FormData;o.append("file",t);let a=await fetch(`${this.baseUrl}/${e}`,{method:"POST",body:o});if(!a.ok)throw Error(`HTTP error! Status: ${a.status}`);return await a.json()}catch(e){throw console.error("API Upload Error:",e),e}},async getBooks(){return this.get("books")},async getBook(e){return this.get(`books/${e}`)},async createBook(e){return this.post("books",e)},async updateBook(e,t){return this.put(`books/${e}`,t)},async deleteBook(e){return this.delete(`books/${e}`)},async updateReadingProgress(e,t){return this.put(`books/${e}/progress`,t)},async getChallenges(){return this.get("challenges")},async createChallenge(e){return this.post("challenges",e)},async updateChallenge(e,t){return this.put(`challenges/${e}`,t)},async importJson(e){return this.uploadFile("import/json",e)},async importCsv(e){return this.uploadFile("import/csv",e)},async exportJson(){return this.get("export/json")}},t={bookModal:null,progressModal:null,challengeModal:null,init(){this.bookModal=new bootstrap.Modal(document.getElementById("book-modal")),this.progressModal=new bootstrap.Modal(document.getElementById("progress-modal")),this.challengeModal=new bootstrap.Modal(document.getElementById("challenge-modal"))},showBookModal(e=null){let t=document.getElementById("book-modal-label");document.getElementById("book-form").reset(),e?(t.textContent="Edit Book",document.getElementById("book-id").value=e.bookId,document.getElementById("title").value=e.title||"",document.getElementById("author").value=e.author||"",document.getElementById("additional-authors").value=e.additionalAuthors||"",document.getElementById("isbn").value=e.isbn||"",document.getElementById("isbn13").value=e.isbn13||"",document.getElementById("publisher").value=e.publisher||"",document.getElementById("binding").value=e.binding||"",document.getElementById("pages").value=e.pages||"",document.getElementById("published").value=e.published||"",document.getElementById("edition-published").value=e.editionPublished||"",document.getElementById("exclusive-shelf").value=e.exclusiveShelf||"to-read",document.getElementById("bookshelves").value=e.bookshelves||"",document.getElementById("rating").value=e.rating||"",document.getElementById("my-review").value=e.myReview||""):(t.textContent="Add New Book",document.getElementById("book-id").value=""),this.bookModal.show()},showProgressModal(e){let t=document.getElementById("book-title"),o=document.getElementById("total-pages"),a=document.getElementById("current-page"),n=document.getElementById("percent-complete"),r=document.getElementById("progress-book-id");document.getElementById("progress-form").reset(),t.value=e.title,o.value=e.pages||0,e.readingProgress?(a.value=e.readingProgress.currentPage||0,n.value=e.readingProgress.percentComplete||0,document.getElementById("percent-display").textContent=`${e.readingProgress.percentComplete||0}%`):(a.value=0,n.value=0,document.getElementById("percent-display").textContent="0%"),a.max=e.pages||100,r.value=e.bookId,this.progressModal.show()},showChallengeModal(e=null){let t=document.getElementById("challenge-modal-label");if(document.getElementById("challenge-form").reset(),e)t.textContent="Edit Reading Challenge",document.getElementById("challenge-year").value=e.year,document.getElementById("challenge-goal").value=e.goal,document.getElementById("challenge-year").disabled=!0;else{t.textContent="New Reading Challenge";let e=new Date().getFullYear();document.getElementById("challenge-year").value=e,document.getElementById("challenge-year").disabled=!1}this.challengeModal.show()},updatePercentFromPage(){let e=document.getElementById("current-page"),t=document.getElementById("total-pages"),o=document.getElementById("percent-complete"),a=document.getElementById("percent-display");if(t.value>0){let n=Math.round(e.value/t.value*100);o.value=n,a.textContent=`${n}%`}},updatePageFromPercent(){let e=document.getElementById("current-page"),t=document.getElementById("total-pages"),o=document.getElementById("percent-complete"),a=document.getElementById("percent-display");t.value>0&&(e.value=Math.round(o.value/100*t.value),a.textContent=`${o.value}%`)},showToast(e,t="success"){let o=document.querySelector(".toast-container");o||((o=document.createElement("div")).className="toast-container position-fixed bottom-0 end-0 p-3",document.body.appendChild(o));let a=document.createElement("div");a.className=`toast align-items-center text-white bg-${t} border-0`,a.setAttribute("role","alert"),a.setAttribute("aria-live","assertive"),a.setAttribute("aria-atomic","true"),a.innerHTML=`
      <div class="d-flex">
        <div class="toast-body">
          ${e}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `,o.appendChild(a),new bootstrap.Toast(a,{autohide:!0,delay:3e3}).show(),a.addEventListener("hidden.bs.toast",()=>{a.remove()})},showConfirmation(e,t){confirm(e)&&t()},renderStarRating(e){let t="";for(let o=1;o<=5;o++)o<=e?t+='<i class="bi bi-star-fill rating-star"></i>':t+='<i class="bi bi-star rating-star"></i>';return t},formatDate(e){if(!e)return"";let t=e.split("/");return 3!==t.length?e:`${t[1]}/${t[2]}/${t[0]}`},getShelfBadge(e){let t="",o="";switch(e){case"read":t="shelf-read",o="bi-check-circle";break;case"currently-reading":t="shelf-currently-reading",o="bi-bookmark";break;case"to-read":t="shelf-to-read",o="bi-hourglass";break;default:t="bg-secondary text-white",o="bi-book"}return`<span class="book-shelf ${t}"><i class="bi ${o} me-1"></i>${this.formatShelfName(e)}</span>`},formatShelfName(e){switch(e){case"read":return"Read";case"currently-reading":return"Currently Reading";case"to-read":return"To Read";default:return e}},createPagination(e,t,o){let a=document.getElementById("pagination");if(a.innerHTML="",t<=1)return;let n=document.createElement("li");n.className=`page-item ${1===e?"disabled":""}`;let r=document.createElement("a");r.className="page-link",r.href="#",r.setAttribute("aria-label","Previous"),r.innerHTML='<span aria-hidden="true">&laquo;</span>',e>1&&r.addEventListener("click",t=>{t.preventDefault(),o(e-1)}),n.appendChild(r),a.appendChild(n);let s=Math.max(1,e-Math.floor(2.5)),l=Math.min(t,s+5-1);l-s+1<5&&(s=Math.max(1,l-5+1));for(let t=s;t<=l;t++){let n=document.createElement("li");n.className=`page-item ${t===e?"active":""}`;let r=document.createElement("a");r.className="page-link",r.href="#",r.textContent=t,t!==e&&r.addEventListener("click",e=>{e.preventDefault(),o(t)}),n.appendChild(r),a.appendChild(n)}let i=document.createElement("li");i.className=`page-item ${e===t?"disabled":""}`;let d=document.createElement("a");d.className="page-link",d.href="#",d.setAttribute("aria-label","Next"),d.innerHTML='<span aria-hidden="true">&raquo;</span>',e<t&&d.addEventListener("click",t=>{t.preventDefault(),o(e+1)}),i.appendChild(d),a.appendChild(i)}},o={books:[],filteredBooks:[],currentPage:1,itemsPerPage:10,totalPages:1,currentFilter:"all",activeFilters:{author:"",genre:"",rating:"",readStatus:""},init(){document.addEventListener("click",e=>{if(e.target.closest(".edit-book-btn")){let t=e.target.closest(".edit-book-btn").getAttribute("data-id");this.editBook(t)}if(e.target.closest(".delete-book-btn")){let t=e.target.closest(".delete-book-btn").getAttribute("data-id");this.confirmDeleteBook(t)}if(e.target.closest(".progress-book-btn")){let t=e.target.closest(".progress-book-btn").getAttribute("data-id");this.showProgressModal(t)}});let e=document.getElementById("apply-filters-btn");e&&e.addEventListener("click",()=>{this.applyFilters()});let t=document.getElementById("clear-filters-btn");t&&t.addEventListener("click",()=>{this.clearFilters()}),this.loadBooks()},async loadBooks(o=1){try{this.currentPage=o,this.currentFilter=null;let a=await e.getBooks();this.books=a,this.filteredBooks=a,this.currentFilter="all",this.currentPage=o,this.totalPages=Math.ceil(a.length/this.itemsPerPage),this.renderBooksTable(a),t.createPagination(o,this.totalPages,e=>{this.currentPage=e,this.renderBooksTable(a)}),this.populateFilterOptions(a),document.getElementById("page-title").textContent="All Books"}catch(e){console.error("Error loading books:",e),t.showToast("Error loading books","danger")}},async loadShelf(o){try{let t=await e.getBooks(),a=t.filter(e=>e.exclusiveShelf===o);this.books=t,this.filteredBooks=a,this.currentFilter=o,this.renderBookCards(a,o)}catch(e){console.error(`Error loading ${o} books:`,e),t.showToast(`Error loading ${o} books`,"danger")}},async loadFavorites(){try{let t=await e.getBooks(),o=t.filter(e=>e.bookshelves&&e.bookshelves.toLowerCase().includes("favorites"));this.books=t,this.filteredBooks=o,this.currentFilter="favorites",this.renderBookCards(o,"favorites")}catch(e){console.error("Error loading favorite books:",e),t.showToast("Error loading favorite books","danger")}},async searchBooks(o){if(!o.trim()){this.loadBooks();return}try{let a=await e.getBooks(),n=a.filter(e=>[e.title||"",e.author||"",e.additionalAuthors||"",e.publisher||"",e.isbn||"",e.isbn13?e.isbn13.toString():""].join(" ").toLowerCase().includes(o.toLowerCase()));this.books=a,this.filteredBooks=n,this.currentFilter="search",this.currentPage=1,this.totalPages=Math.ceil(n.length/this.itemsPerPage),this.renderBooksTable(n),t.createPagination(1,this.totalPages,e=>{this.currentPage=e,this.renderBooksTable(n)}),document.getElementById("page-title").textContent=`Search Results: ${n.length} books found`,document.querySelectorAll(".page-content").forEach(e=>{e.classList.add("d-none")}),document.getElementById("books-page").classList.remove("d-none"),console.log(`Search results for "${o}":`,n)}catch(e){console.error("Error searching books:",e),t.showToast("Error searching books","danger")}},populateFilterOptions(e){let t=[...new Set(e.map(e=>e.author).filter(Boolean))].sort(),o=document.getElementById("filter-author");for(;o.options.length>1;)o.remove(1);t.forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,o.appendChild(t)});let a=[...new Set(e.map(e=>e.bookshelves).filter(Boolean).flatMap(e=>e.split(",").map(e=>e.trim())))].sort(),n=document.getElementById("filter-genre");for(;n.options.length>1;)n.remove(1);a.forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)})},applyFilters(){let e=document.getElementById("filter-author").value,o=document.getElementById("filter-genre").value,a=document.getElementById("filter-rating").value,n=document.getElementById("filter-read-status").value;this.activeFilters={author:e,genre:o,rating:a,readStatus:n};let r=this.books;if(e&&(r=r.filter(t=>t.author===e)),o&&(r=r.filter(e=>(e.bookshelves||"").split(",").map(e=>e.trim()).includes(o))),a){let e=parseInt(a);r=r.filter(t=>(t.rating||0)>=e)}n&&(r=r.filter(e=>e.exclusiveShelf===n)),this.filteredBooks=r,this.currentFilter="filter",this.currentPage=1,this.totalPages=Math.ceil(r.length/this.itemsPerPage),this.renderBooksTable(r),t.createPagination(1,this.totalPages,e=>{this.currentPage=e,this.renderBooksTable(r)}),document.getElementById("page-title").textContent=`Filtered Results: ${r.length} books found`,document.querySelectorAll(".page-content").forEach(e=>{e.classList.add("d-none")}),document.getElementById("books-page").classList.remove("d-none"),bootstrap.Modal.getInstance(document.getElementById("filter-modal")).hide(),this.showFilterSummary()},clearFilters(){document.getElementById("filter-form").reset(),this.activeFilters={author:"",genre:"",rating:"",readStatus:""},this.loadBooks(),bootstrap.Modal.getInstance(document.getElementById("filter-modal")).hide()},showFilterSummary(){let{author:e,genre:o,rating:a,readStatus:n}=this.activeFilters;if(!e&&!o&&!a&&!n)return;let r="Filters applied: ",s=[];e&&s.push(`Author: ${e}`),o&&s.push(`Genre: ${o}`),a&&s.push(`${a}+ Stars`),n&&s.push(`Status: ${t.formatShelfName(n)}`),r+=s.join(", "),t.showToast(r,"info")},renderBooksTable(e){let o=document.getElementById("books-table-body");o.innerHTML="";let a=(this.currentPage-1)*this.itemsPerPage,n=Math.min(a+this.itemsPerPage,e.length),r=e.slice(a,n);if(0===r.length){o.innerHTML=`
        <tr>
          <td colspan="6" class="text-center">No books found</td>
        </tr>
      `;return}r.forEach(e=>{let a=document.createElement("tr"),n=document.createElement("td");n.innerHTML=`<span class="book-title">${e.title}</span>`,a.appendChild(n);let r=document.createElement("td");r.innerHTML=`<span class="book-author">${e.author}</span>`,a.appendChild(r);let s=document.createElement("td");s.innerHTML=`<div class="book-rating">${t.renderStarRating(e.rating)}</div>`,a.appendChild(s);let l=document.createElement("td");l.innerHTML=t.getShelfBadge(e.exclusiveShelf),a.appendChild(l);let i=document.createElement("td");i.textContent=e.pages||"-",a.appendChild(i);let d=document.createElement("td");d.innerHTML=`
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-sm btn-outline-primary action-btn progress-book-btn" data-id="${e.bookId}" title="Update Progress">
            <i class="bi bi-bookmark"></i>
          </button>
          <button type="button" class="btn btn-sm btn-outline-secondary action-btn edit-book-btn" data-id="${e.bookId}" title="Edit">
            <i class="bi bi-pencil"></i>
          </button>
          <button type="button" class="btn btn-sm btn-outline-danger action-btn delete-book-btn" data-id="${e.bookId}" title="Delete">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      `,a.appendChild(d),o.appendChild(a)})},renderBookCards(e,o){let a=document.getElementById(`${o}-books`);if(a.innerHTML="",0===e.length){a.innerHTML=`
        <div class="col-12 text-center my-5">
          <h5>No books found</h5>
        </div>
      `;return}e.forEach(e=>{let o=document.createElement("div");o.className="col-md-6 col-lg-4 col-xl-3 mb-4";let n="";if("currently-reading"===e.exclusiveShelf&&e.readingProgress){let t=e.readingProgress.percentComplete||0,o=e.readingProgress.currentPage||0,a=e.pages||0;n=`
          <div class="progress-container">
            <div class="progress">
              <div class="progress-bar bg-success" role="progressbar" style="width: ${t}%" 
                aria-valuenow="${t}" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <div class="progress-info">
              <span>${o} of ${a} pages</span>
              <span>${t}% complete</span>
            </div>
          </div>
        `}o.innerHTML=`
        <div class="card book-card">
          <div class="card-img-top">
            <i class="bi bi-book"></i>
          </div>
          <div class="card-body">
            <h5 class="card-title">${e.title}</h5>
            <p class="card-author">${e.author}</p>
            <div class="card-rating mb-2">${t.renderStarRating(e.rating)}</div>
            ${t.getShelfBadge(e.exclusiveShelf)}
            ${n}
            <div class="mt-3">
              <button type="button" class="btn btn-sm btn-outline-primary progress-book-btn" data-id="${e.bookId}">
                <i class="bi bi-bookmark me-1"></i>Update Progress
              </button>
              <div class="btn-group mt-2" role="group">
                <button type="button" class="btn btn-sm btn-outline-secondary edit-book-btn" data-id="${e.bookId}">
                  <i class="bi bi-pencil"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-danger delete-book-btn" data-id="${e.bookId}">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      `,a.appendChild(o)})},async saveBook(){try{let o=document.getElementById("book-id").value,a=document.getElementById("title").value,n=document.getElementById("author").value,r=document.getElementById("additional-authors").value,s=document.getElementById("isbn").value,l=document.getElementById("isbn13").value,i=document.getElementById("publisher").value,d=document.getElementById("binding").value,c=document.getElementById("pages").value,u=document.getElementById("published").value,g=document.getElementById("edition-published").value,h=document.getElementById("exclusive-shelf").value,m=document.getElementById("bookshelves").value,p=document.getElementById("rating").value,b=document.getElementById("my-review").value,y={title:a,author:n,additionalAuthors:r,isbn:s,isbn13:l?parseInt(l):null,publisher:i,binding:d,pages:c?parseInt(c):null,published:u?parseInt(u):null,editionPublished:g?parseInt(g):null,exclusiveShelf:h,bookshelves:m,rating:p?parseInt(p):null,myReview:b,dateAdded:new Date().toISOString().split("T")[0].replace(/-/g,"/")};o?(await e.updateBook(o,y),t.showToast("Book updated successfully","success")):(await e.createBook(y),t.showToast("Book added successfully","success")),t.bookModal.hide(),this.currentFilter?"favorites"===this.currentFilter?this.loadFavorites():this.loadShelf(this.currentFilter):this.loadBooks(this.currentPage)}catch(e){console.error("Error saving book:",e),t.showToast("Error saving book","danger")}},async editBook(o){try{let a=this.books.find(e=>e.bookId==o);if(a)t.showBookModal(a);else{let a=await e.getBook(o);t.showBookModal(a)}}catch(e){console.error("Error editing book:",e),t.showToast("Error loading book details","danger")}},confirmDeleteBook(e){t.showConfirmation("Are you sure you want to delete this book?",()=>{this.deleteBook(e)})},async deleteBook(o){try{await e.deleteBook(o),t.showToast("Book deleted successfully","success"),this.currentFilter?"favorites"===this.currentFilter?this.loadFavorites():this.loadShelf(this.currentFilter):this.loadBooks(this.currentPage)}catch(e){console.error("Error deleting book:",e),t.showToast("Error deleting book","danger")}},async showProgressModal(o){try{let a=this.books.find(e=>e.bookId==o);a||(a=await e.getBook(o)),a&&t.showProgressModal(a)}catch(e){console.error("Error showing progress modal:",e),t.showToast("Error loading book details","danger")}},async saveReadingProgress(){try{let o=document.getElementById("progress-book-id").value,a=parseInt(document.getElementById("current-page").value),n=parseInt(document.getElementById("percent-complete").value);await e.updateReadingProgress(o,{currentPage:a,percentComplete:n}),t.showToast("Reading progress updated","success"),t.progressModal.hide(),this.currentFilter?"favorites"===this.currentFilter?this.loadFavorites():this.loadShelf(this.currentFilter):this.loadBooks(this.currentPage)}catch(e){console.error("Error saving reading progress:",e),t.showToast("Error updating reading progress","danger")}}},a={challenges:[],init(){},async loadChallenges(){try{let t=await e.getChallenges();this.challenges=t,this.renderChallenges(t),this.createReadingProgressChart(t)}catch(e){console.error("Error loading challenges:",e),t.showToast("Error loading reading challenges","danger")}},renderChallenges(e){this.renderCurrentChallenge(e),this.renderPastChallenges(e)},renderCurrentChallenge(e){let o=new Date().getFullYear(),a=e.find(e=>e.year===o),n=document.getElementById("current-challenge");if(!a){n.innerHTML=`
        <div class="text-center py-4">
          <p>No reading challenge set for ${o}</p>
          <button class="btn btn-primary" id="new-challenge-btn">
            <i class="bi bi-plus-lg me-2"></i>Set a Reading Goal
          </button>
        </div>
      `,document.getElementById("new-challenge-btn").addEventListener("click",()=>{t.showChallengeModal()});return}let r=Math.min(100,Math.round(a.completed/a.goal*100)),s="bg-success";r<25?s="bg-danger":r<50?s="bg-warning":r<75&&(s="bg-info"),n.innerHTML=`
      <div class="challenge-card">
        <h2 class="text-center mb-3">${o} Reading Challenge</h2>
        <div class="text-center mb-4">
          <h3>
            <span class="badge ${r>=100?"bg-success":"bg-primary"}">
              ${a.completed} of ${a.goal} books
            </span>
          </h3>
        </div>
        <div class="progress challenge-progress">
          <div class="progress-bar ${s}" role="progressbar" 
            style="width: ${r}%" 
            aria-valuenow="${r}" 
            aria-valuemin="0" 
            aria-valuemax="100">
            ${r}%
          </div>
        </div>
        <div class="challenge-info">
          <span>Started: ${new Date(a.createdAt).toLocaleDateString()}</span>
          <span>${a.goal-a.completed} books to go</span>
        </div>
        <div class="text-center mt-4">
          <button class="btn btn-outline-primary edit-challenge-btn" data-year="${a.year}">
            <i class="bi bi-pencil me-2"></i>Edit Challenge
          </button>
        </div>
      </div>
    `,document.querySelector(".edit-challenge-btn").addEventListener("click",()=>{this.editChallenge(a.year)})},renderPastChallenges(e){let t=new Date().getFullYear(),o=e.filter(e=>e.year!==t).sort((e,t)=>t.year-e.year),a=document.getElementById("past-challenges");if(0===o.length){a.innerHTML=`
        <tr>
          <td colspan="4" class="text-center">No past reading challenges</td>
        </tr>
      `;return}a.innerHTML="",o.forEach(e=>{let t=Math.min(100,Math.round(e.completed/e.goal*100)),o="bg-success";t<25?o="bg-danger":t<50?o="bg-warning":t<75&&(o="bg-info");let n=document.createElement("tr");n.innerHTML=`
        <td>${e.year}</td>
        <td>${e.goal}</td>
        <td>${e.completed}</td>
        <td>
          <div class="progress">
            <div class="progress-bar ${o}" role="progressbar" 
              style="width: ${t}%" 
              aria-valuenow="${t}" 
              aria-valuemin="0" 
              aria-valuemax="100">
              ${t}%
            </div>
          </div>
        </td>
      `,a.appendChild(n)})},createReadingProgressChart(e){let t=new Date().getFullYear(),o=e.find(e=>e.year===t);if(!o)return;let a=document.getElementById("reading-progress-chart").getContext("2d"),n=this.generateMonthlyData(o.completed),r=Array(12).fill(0).map((e,t)=>Math.round((t+1)/12*o.goal));new Chart(a,{type:"line",data:{labels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],datasets:[{label:"Books Read",data:n.cumulative,backgroundColor:"rgba(0, 123, 255, 0.1)",borderColor:"rgba(0, 123, 255, 1)",borderWidth:2,fill:!0,tension:.4},{label:"Target",data:r,borderColor:"rgba(220, 53, 69, 0.5)",borderWidth:2,borderDash:[5,5],fill:!1,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{precision:0}}},plugins:{tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"",o=e.parsed.y;return`${t}: ${o} books`}}}}}})},generateMonthlyData(e){let t=new Date().getMonth(),o=Array(12).fill(0),a=e;for(let e=0;e<=t;e++){if(e===t)o[e]=a;else{let t=Math.floor(a/2*Math.random())+1;o[e]=Math.min(t,a),a-=o[e]}if(a<=0)break}let n=[],r=0;for(let e=0;e<12;e++)n.push(r+=o[e]);return{monthly:o,cumulative:n}},async saveChallenge(){try{let o=parseInt(document.getElementById("challenge-year").value),a=parseInt(document.getElementById("challenge-goal").value);if(!o||!a){t.showToast("Please fill in all fields","warning");return}let n=this.challenges.find(e=>e.year===o);n?(await e.updateChallenge(o,{goal:a,completed:n.completed}),t.showToast("Reading challenge updated","success")):(await e.createChallenge({year:o,goal:a}),t.showToast("Reading challenge created","success")),t.challengeModal.hide(),this.loadChallenges()}catch(e){console.error("Error saving challenge:",e),t.showToast("Error saving reading challenge","danger")}},editChallenge(e){let o=this.challenges.find(t=>t.year===e);o&&t.showChallengeModal(o)}},n={init(){},async importBooks(){try{let a;let n=document.getElementById("import-file");if(!n.files||0===n.files.length){t.showToast("Please select a file to import","warning");return}let r=n.files[0],s=this.getFileType(r.name);if(!s){t.showToast("Unsupported file format. Please use JSON or CSV files.","warning");return}t.showToast("Importing books, please wait...","info"),"json"===s?a=await e.importJson(r):"csv"===s&&(a=await e.importCsv(r)),t.showToast(a.message,"success"),n.value="",o.loadBooks()}catch(e){console.error("Error importing books:",e),t.showToast("Error importing books","danger")}},async exportBooks(o){try{t.showToast(`Preparing ${o.toUpperCase()} export...`,"info");let a=await e.exportJson();"json"===o?this.exportJson(a):"csv"===o&&this.exportCsv(a)}catch(e){console.error("Error exporting books:",e),t.showToast("Error exporting books","danger")}},exportJson(e){let o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=new Date().toISOString().split("T")[0];saveAs(o,`book_export_${a}.json`),t.showToast("Books exported to JSON successfully","success")},exportCsv(e){let o=this.getAllHeaders(e),a=o.join(",")+"\\n";e.forEach(e=>{let t=o.map(t=>{let o=e[this.camelCase(t)];return null==o?"":"string"==typeof o?'"'+o.replace(/"/g,'""')+'"':Array.isArray(o)?'"'+JSON.stringify(o).replace(/"/g,'""')+'"':o});a+=t.join(",")+"\\n"});let n=new Blob([a],{type:"text/csv;charset=utf-8"}),r=new Date().toISOString().split("T")[0];saveAs(n,`book_export_${r}.csv`),t.showToast("Books exported to CSV successfully","success")},getFileType(e){let t=e.split(".").pop().toLowerCase();return"json"===t?"json":"csv"===t?"csv":null},getAllHeaders(e){let t=new Set;return["Book Id","Title","Author","Author (By Last Name)","Additional Authors","ISBN","ISBN13","Rating","Average Rating","Publisher","Binding","Pages","BEq","Edition Published","Published","Date Read","Date Added","Bookshelves","Bookshelves with positions","Exclusive Shelf","My Review","Spoiler","Private Notes","Read Count","Owned Copies"].forEach(e=>t.add(e)),Array.from(t)},camelCase:e=>"Book Id"===e?"bookId":"Author (By Last Name)"===e?"authorByLastName":"BEq"===e?"beq":"ISBN"===e?"isbn":"ISBN13"===e?"isbn13":"Bookshelves with positions"===e?"bookshelvesWithPositions":"Exclusive Shelf"===e?"exclusiveShelf":"My Review"===e?"myReview":"Read Count"===e?"readCount":"Owned Copies"===e?"ownedCopies":"Edition Published"===e?"editionPublished":"Date Read"===e?"dateRead":"Date Added"===e?"dateAdded":"Private Notes"===e?"privateNotes":"Average Rating"===e?"averageRating":e.toLowerCase().replace(/\s(.)/g,(e,t)=>t.toUpperCase())};document.addEventListener("DOMContentLoaded",()=>{e.init(),t.init(),o.init(),a.init(),n.init(),o.loadBooks(),a.loadChallenges(),function(){let e=document.querySelectorAll(".nav-link");e.forEach(t=>{t.addEventListener("click",n=>{n.preventDefault(),e.forEach(e=>e.classList.remove("active")),t.classList.add("active");let r=t.getAttribute("data-page");document.getElementById("page-title").textContent=t.textContent.trim(),document.querySelectorAll(".page-content").forEach(e=>e.classList.add("d-none"));let s=document.getElementById(`${r}-page`);s&&s.classList.remove("d-none"),"books"===r?o.loadBooks():"currently-reading"===r?o.loadShelf("currently-reading"):"read"===r?o.loadShelf("read"):"to-read"===r?o.loadShelf("to-read"):"favorites"===r?o.loadFavorites():"challenges"===r&&a.loadChallenges()})})}(),function(){document.getElementById("add-book-btn").addEventListener("click",()=>{t.showBookModal()}),document.getElementById("save-book-btn").addEventListener("click",()=>{o.saveBook()}),document.getElementById("search-button").addEventListener("click",()=>{let e=document.getElementById("search-input");o.searchBooks(e.value)});let e=document.getElementById("search-input");e.addEventListener("keyup",t=>{"Enter"===t.key&&o.searchBooks(e.value)}),document.getElementById("new-challenge-btn").addEventListener("click",()=>{t.showChallengeModal()}),document.getElementById("save-challenge-btn").addEventListener("click",()=>{a.saveChallenge()}),document.getElementById("save-progress-btn").addEventListener("click",()=>{o.saveReadingProgress()}),document.getElementById("current-page").addEventListener("input",()=>{t.updatePercentFromPage()}),document.getElementById("percent-complete").addEventListener("input",()=>{t.updatePageFromPercent()}),document.getElementById("import-form").addEventListener("submit",e=>{e.preventDefault(),n.importBooks()}),document.getElementById("export-json-btn").addEventListener("click",()=>{n.exportBooks("json")}),document.getElementById("export-csv-btn").addEventListener("click",()=>{n.exportBooks("csv")})}()});
//# sourceMappingURL=index.f605556f.js.map
